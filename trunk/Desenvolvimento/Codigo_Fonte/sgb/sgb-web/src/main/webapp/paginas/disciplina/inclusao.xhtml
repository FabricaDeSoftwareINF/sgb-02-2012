<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets">

    <ui:composition template="/template/template.xhtml">

        <ui:define name="title">
            Cadastro de Disciplina - SGB
        </ui:define>

        <ui:define name="content">

            <h:form id="formInicial" prependId="false">

                <p:panel header="#{msg['label.disciplina.title.cadastroDisciplina']}">

                    <p:messages autoUpdate="true"/>

                    <h:panelGrid style="width: 100%;">

                        <h:panelGrid columns="6" style="width: 100%;">

                            <h:outputLabel value="#{msg['label.disciplina.codigo']}:"></h:outputLabel>

                            <p:inputText value="#{disciplinaController.form.entity.codigo}"></p:inputText>

                            <h:outputLabel value="#{msg['label.disciplina.nome']}:"></h:outputLabel>

                            <p:inputText value="#{disciplinaController.form.entity.nome}"></p:inputText>

                            <h:outputLabel value="#{msg['label.disciplina.curso']}:"></h:outputLabel>

                            <p:selectOneMenu value="#{disciplinaController.form.entity.curso}" converter="cursoConverter" >

                                <f:selectItems value="#{disciplinaController.form.cursos}" var="curso" itemLabel="#{curso.nome}"/>

                            </p:selectOneMenu>

                        </h:panelGrid>

                        <p:fieldset style="width: 97%;" legend="#{msg['label.disciplina.associacaoLivro']}">

                            <h:panelGrid columns="2">

                                <h:outputLabel value="#{msg['label.disciplina.tipoBibliografia']}:"></h:outputLabel>

                                <p:selectOneMenu value="#{disciplinaController.form.tipoBibliografiaSelecionado}">

                                    <f:selectItems value="#{disciplinaController.form.tipoBibliografias}" var="tipo" itemLabel="#{tipo.value}"></f:selectItems>

                                </p:selectOneMenu>

                                <h:outputLabel value="#{msg['label.disciplina.tituloLivro']}:"></h:outputLabel>

                                <p:autoComplete value="#{disciplinaController.form.livrosSelecionados}" converter="livroConverter" 
                                                completeMethod="#{disciplinaController.buscaLivros}" var="livro" itemLabel="#{livro.titulo}" itemValue="#{livro}" 
                                                multiple="true" immediate="true" global="true" queryDelay="1000">
                                    
                                    <p:ajax event="itemSelect"  listener="#{disciplinaController.addLivroOnSelect}" process="@this" immediate="true"></p:ajax>
                                    
                                    <p:ajax event="itemUnselect" listener="#{disciplinaController.removeOnUnselect}" process="@this" immediate="true"></p:ajax>
                                
                                </p:autoComplete>

                                <p:spacer width="10"/>

                                <p:commandButton value="#{msg['label.disciplina.associarLivro']}" action="#{disciplinaController.associarLivros}" ajax="false" immediate="true" process="@form"></p:commandButton>

                            </h:panelGrid>

                            <p:dataTable id="dtTable" value="#{disciplinaController.form.bibliografiasAssociadas}" var="bibliografia" paginator="true" rows="10" >

                                <p:column headerText="#{msg['label.disciplina.tipoBibliografia']}">

                                    <h:outputText value="#{bibliografia.tipo.value}"></h:outputText>

                                </p:column>

                                <p:column headerText="#{msg['label.disciplina.tituloLivro']}">

                                    <h:outputText value="#{bibliografia.livro.titulo}"></h:outputText>

                                </p:column>

                                <p:column headerText="#{msg['label.disciplina.acao']}">

                                    <h:commandLink value="#{msg['cadastro.acao.remover']}"  actionListener="#{disciplinaController.desassociarBibliografia}" >
                                        
                                        <f:setPropertyActionListener target="#{disciplinaController.form.bibliografiaSelecionada}" value="#{bibliografia}"></f:setPropertyActionListener>
                                   
                                    </h:commandLink>

                                </p:column>

                            </p:dataTable>

                        </p:fieldset>

                        <h:panelGrid columns="2" style="float: right">

                            <p:commandButton value="#{msg['label.disciplina.cadastrar']}"></p:commandButton>

                            <p:commandButton value="#{msg['label.disciplina.voltar']}"></p:commandButton>

                        </h:panelGrid>

                    </h:panelGrid>

                    <p:confirmDialog id="dialogRemocao" message="#{msg['label.disciplina.mensagem.removerAssociacao']}"
                                     header="#{msg['label.disciplina.tituloDialog.removerBibliografia']}" severity="alert" 
                                     widgetVar="alertRemocao" visible="#{disciplinaController.form.exibirDialogRemocao}">
                        <center>

                            <p:commandButton value="#{msg['label.sim']}" action="#{disciplinaController.inserir}" ajax="false"></p:commandButton>

                            <p:commandButton value="#{msg['label.nao']}" action="#" ajax="false"></p:commandButton>

                        </center>

                    </p:confirmDialog>
                
                </p:panel>

            </h:form>

        </ui:define>

    </ui:composition>

</html>