<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">

    <ui:composition template="/template/template.xhtml">


        <ui:define name="title">
            Cadastro de Livro - SGB
        </ui:define>


        <ui:define name="content">

            <ui:include src="cadastro_autor_dialog.xhtml"/>
            <ui:include src="cadastro_editora_dialog.xhtml"/>

            <h:form id="form_livro">
                <p:messages  autoUpdate="true"/>
                <h:panelGrid columns="6">
                    <h:outputLabel value="#{msg['cadastro.livro.label.titulo']}"  ></h:outputLabel>
                    <p:inputText required="true" value="#{livroController.form.entity.titulo}" requiredMessage="Por favor Informe o Titulo." />
                    <h:outputLabel value="#{msg['cadastro.livro.label.edicao']}"  ></h:outputLabel>
                    <p:inputText required="true" value="#{livroController.form.entity.edicao}" requiredMessage="Por favor Informe a Edicao." />
                    <h:outputLabel value="#{msg['cadastro.livro.label.isbn10']}" ></h:outputLabel>
                    <p:inputMask required="true" value="#{livroController.form.entity.isbn10}" mask="9999999999"/>
                    <h:outputLabel value="#{msg['cadastro.livro.label.autor']}" ></h:outputLabel>
                    <h:panelGrid columns="2" >
                        <p:autoComplete required="true" id="autorCompleteAutor" value="#{livroController.form.entity.autores}" completeMethod="#{livroController.completeAutor}"  
                                        var="autor" itemLabel="#{autor.toString()}" itemValue="#{autor}" converter="autorConverter" multiple="true">
                            <p:ajax event="itemUnselect" listener="#{livroController.handleUnselectAutor}" /> 
                        </p:autoComplete>  
                        <p:commandButton onclick="cadastroAutorDialog.show()" immediate="true" value="+"></p:commandButton>
                    </h:panelGrid>
                    <h:outputLabel value="#{msg['cadastro.livro.label.editora']}" ></h:outputLabel>
                    <h:panelGrid columns="2">
                        <p:autoComplete required="ture" id="autoCompleteEditora" value="#{livroController.form.entity.editora}" completeMethod="#{livroController.completeEditora}"  
                                        var="editora" itemLabel="#{editora.nome}" itemValue="#{editora}" converter="editoraConverter" ></p:autoComplete>  
                        <p:commandButton oncomplete="cadastroEditoraDialog.show()" immediate="true" value="+"></p:commandButton>
                    </h:panelGrid>
                    <h:outputLabel value="#{msg['cadastro.livro.label.isbn13']}" ></h:outputLabel>
                    <p:inputMask required="true" value="#{livroController.form.entity.isbn13}" type="number" 
                                 requiredMessage="Por favor Informe o ISBN correto." mask="9999999999999"/>
                    <h:outputLabel value="#{msg['cadastro.livro.label.ano']}" ></h:outputLabel>
                    <p:inputMask value="#{livroController.form.entity.ano}" type="number" size="4" maxlength="4" mask="9999"/>
                </h:panelGrid>
                <p:fieldset id="associar_disciplina_panel" legend="#{msg['cadastro.livro.legend.associarDisciplina']}">
                    <h:panelGrid columns="2">
                        <h:outputLabel value="Tipo:"></h:outputLabel>
                        <p:selectOneMenu value="#{livroController.form.tipoBibliografia}" converter="enumTipoBibliografiaConverter">
                            <f:selectItem itemLabel="#{msg['cadastro.livro.input.selecione']}"/>
                            <f:selectItems value="#{livroController.form.tiposBibliografia}" var="tipoBibliografia"
                                           itemValue="#{tipoBibliografia}" itemLabel="#{tipoBibliografia.value}"/>
                        </p:selectOneMenu>
                        <h:outputLabel value="Curso:"></h:outputLabel>
                        <p:selectOneMenu value="#{livroController.form.cursoSelecionado}"  converter="cursoConverter">
                            <p:ajax event="change" process="@this" update="disciplina" listener="#{livroController.limparDisciplina}" />
                            <f:selectItem itemLabel="#{msg['cadastro.livro.input.selecione']}"/>
                            <f:selectItems  var="curso" value="#{livroController.cursoService.list()}" itemLabel="#{curso.nome}" itemValue="#{curso}"/>
                        </p:selectOneMenu>
                        <h:outputLabel value="Disciplina:"></h:outputLabel>
                        <p:autoComplete id="disciplina" value="#{livroController.form.bibliografiaTemp.disciplina}" 
                                        completeMethod="#{livroController.completeDisciplina}"  
                                        var="disciplina" itemLabel="#{disciplina.nome}" itemValue="#{disciplina}" converter="disciplinaConverter" ></p:autoComplete>  
                        <div></div>
                        <p:commandButton value="Associar disciplina" actionListener="#{livroController.associarDisciplina}" 
                                         update="table_disciplinas, associar_disciplina_panel" process="associar_disciplina_panel"></p:commandButton>
                    </h:panelGrid>

                    <p:dataTable id="table_disciplinas" value="#{livroController.form.entity.bibliografias}" var="bibliografia">
                        <p:column headerText="Tipo">
                            <h:outputText value="#{bibliografia.tipo.value}"/>
                        </p:column>
                        <p:column headerText="Curso">
                            <h:outputText value="#{bibliografia.disciplina.curso.nome}"/>
                        </p:column>
                        <p:column headerText="Disciplina">
                            <h:outputText value="#{bibliografia.disciplina.nome}"/>
                        </p:column>
                        <p:column headerText="Ação">
                            <p:commandLink value="Remover" action="#{livroController.form.setBibliografiaRemocao(bibliografia)}"
                                           oncomplete="dlgRemocao.show()"/>
                        </p:column>
                    </p:dataTable>
                </p:fieldset>
                <h:panelGrid columns="2" style="float: right;">

                    <p:commandButton update="@form" actionListener="#{livroController.salvarLivro()}" value="#{msg['cadastro.livro.button.cadastrar']}" />

                    <p:commandButton  ajax="false" immediate="true"  action="#{livroController.openInitialPage()}" value="#{msg['cadastro.livro.button.back']}" />

                </h:panelGrid>

                <p:dialog id="dialog_remocao_disciplina" widgetVar="dlgRemocao" modal="true"
                          resizable="false" closable="false">

                    <h:panelGrid columns="1" style="text-align: center;">

                        <h:outputText value="#{msg['cadastro.autor.label.remocao']}"/>

                        <p:spacer height="10"/>

                        <h:panelGrid columns="2" style="margin-left: 30%;">

                            <p:commandButton value="#{msg['cadastro.autor.label.sim']}" update="table_disciplinas"
                                             action="#{livroController.removerBibliografia}" oncomplete="dlgRemocao.hide()"/>

                            <p:commandButton value="#{msg['cadastro.autor.label.nao']}"
                                             onclick="dlgRemocao.hide();"/>

                        </h:panelGrid>

                    </h:panelGrid>

                </p:dialog>

            </h:form>

        </ui:define>
    </ui:composition>

</html>